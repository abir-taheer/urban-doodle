"use strict";let useGoogleAnalytics="true"===$("meta[name=use-google-analytics]").attr("content"),isSignedIn="true"===$("meta[name=signed-in]").attr("content"),gtagTrackingID=useGoogleAnalytics?$("meta[name=gtag-tracking-id]").attr("content"):"";function onSignIn(e){let t=e.getAuthResponse().id_token;$.post("/auth.php",{token:t},function(e){let t=JSON.parse(e);if("success"===t.status)useGoogleAnalytics&&gtag("event","login",{method:"Google"}),addSnackbarQueue("You have been successfully signed in"),window.location.reload();else{let e=0;for(;e<t.message.length;)addSnackbarQueue(t.message[e]),e++;playSnackbarQueue()}})}let manDrawTrig=!1;function changePage(e=null){let t=document.getElementById("variable-region"),a=document.querySelector(".page-loader");$(a).removeClass("mdc-linear-progress--closed"),$(t).fadeOut(1),$(t).find("link").prop("disabled",!0),$(t).empty(),null!==e&&history.pushState({},null,e);let n=document.querySelector(".drawer-pages-list").childNodes,r=window.location.pathname.split("/")[1];for(let e=0;e<n.length;e++){let t=n[e];$(t).data("page")==="/"+r?$(t).addClass("mdc-list-item--activated"):$(t).removeClass("mdc-list-item--activated")}$.get("/load.php?page="+window.location.pathname,function(e,a,n){$(t).html(e),null===n.getResponseHeader("X-Page-Redirect")?("true"===n.getResponseHeader("X-Fetch-New-Sources")&&addSources(n),null!==n.getResponseHeader("X-Load-Sub")&&loadSubPage()):changePage(n.getResponseHeader("X-Page-Redirect"))}).fail(function(){$(t).fadeIn(),$(a).addClass("mdc-linear-progress--closed")}).then(function(){$(t).ready(function(){$(a).addClass("mdc-linear-progress--closed"),$(t).fadeIn()})}),useGoogleAnalytics&&gtag("config",gtagTrackingID,{page_path:window.location.pathname}),playSnackbarQueue()}function addSources(e){let t,a,n=document.getElementById("variable-region"),r=JSON.parse(e.getResponseHeader("X-New-Sources")),o=e.getResponseHeader("X-Nonce");for(t in r.script){let e=document.createElement("script");e.setAttribute("nonce",o),e.setAttribute("src",r.script[t]),n.appendChild(e)}for(a in r.css){let e=document.createElement("link");e.setAttribute("nonce",o),e.setAttribute("rel","stylesheet"),e.setAttribute("href",r.css[t]),n.appendChild(e)}}function loadSubPage(e=null){null!==e&&history.pushState({},null,e),$.get("/subload.php?page="+window.location.pathname,(e,t,a)=>{$("#sub-variable-region").html(e)})}$(".obs").on("click",e=>{drawer.open=!1,$(e.currentTarget).addClass("fear"),$("#variable-region").fadeIn()}),$(document).ready(()=>{let e=document.querySelector(".drawer-pages-list"),t=JSON.parse(atob(e.getAttribute("data-menu-items")));for(let a=0;a<t.length;a++){if("*"!==t[a].session&&t[a].session!==$("meta[name=signed-in]").attr("content"))continue;let n=document.createElement("a");n.classList.add("mdc-list-item"),n.classList.add("change-page"),n.classList.add("clickable"),n.setAttribute("data-mdc-auto-init","MDCRipple"),n.setAttribute("data-page",t[a].page);let r=document.createElement("a");r.classList.add("material-icons"),r.classList.add("mdc-list-item__graphic"),r.innerHTML=t[a].icon,n.appendChild(r);let o=document.createElement("span");o.classList.add("mdc-list-item__text"),o.innerHTML=t[a].text,n.appendChild(o),e.appendChild(n)}changePage(),playSnackbarQueue()}),mdc.autoInit(),$(document.body).on("click",".sub-page-change",e=>{loadSubPage(e.currentTarget.getAttribute("data-page"))});let drawer=new mdc.drawer.MDCDrawer(document.querySelector(".mdc-drawer")),snackbar=new mdc.snackbar.MDCSnackbar(document.querySelector(".mdc-snackbar"));function playSnackbarQueue(){try{let e=JSON.parse(localStorage.getItem("snackbar"));e.length>0&&(snackbar.labelText=e[0],$(".mdc-snackbar__action").addClass("fear"),e.shift(),snackbar.open(),localStorage.setItem("snackbar",JSON.stringify(e)))}catch(e){localStorage.setItem("snackbar","[]")}}function addSnackbarQueue(e){try{if("object"!=typeof JSON.parse(localStorage.getItem("snackbar")))throw new Error("Snackbar not setup")}catch(e){localStorage.setItem("snackbar","[]")}let t=JSON.parse(localStorage.getItem("snackbar"));t.push(e),localStorage.setItem("snackbar",JSON.stringify(t))}window.innerWidth>1250&&(drawer.open=!0),$(document.body).on("click",".menu-trigger",()=>{let e=$("#variable-region"),t=$(".obs");window.innerWidth<1250?(drawer.open?e.fadeIn():e.fadeOut(1),drawer.open?t.addClass("fear"):t.removeClass("fear")):e.fadeIn(),drawer.open=!drawer.open,!manDrawTrig&&window.innerWidth>1250&&(manDrawTrig=!0)}),window.onpopstate=function(){changePage()},$(document.body).on("click",".change-page",e=>{changePage($(e.currentTarget).data("page")),window.innerWidth<=1250&&(drawer.open=!1,$(".obs").addClass("fear"))}),$("#variable-region").on("DOMSubtreeModified",()=>{window.mdc.autoInit(document,()=>{})}),$(document.body).on("click",".sign-out",()=>{location.replace("/signout.php")}),isSignedIn||(navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&!navigator.userAgent.match(/(FB|Messenger)/)?document.pagehide=(()=>{gapi.auth2.getAuthInstance().disconnect()}):window.onbeforeunload=(()=>{gapi.auth2.getAuthInstance().disconnect()})),$(window).resize(()=>{window.innerWidth<=1250?drawer.open&&(drawer.open=!1):(manDrawTrig||(drawer.open=!0),$("#variable-region").fadeIn())}),$(document.body).on("click",".submit-form",e=>{let t=e.currentTarget;t.setAttribute("disabled",!0);let a=t.parentElement.parentElement,n=$(a).find("form");$.post($(n).data("action"),$(n).serialize(),(e,a,r)=>{let o=JSON.parse(e);for(let e=0;e<o.message.length;e++)addSnackbarQueue(o.message[e]);if("success"===o.status)switch($(n).data("callback")){case"reload":changePage()}else t.removeAttribute("disabled"),playSnackbarQueue()})}),snackbar.listen("MDCSnackbar:closed",()=>{playSnackbarQueue()});let pageLoadedTime=new Date,pageLoadOffset=pageLoadedTime.getTime()-pageLoadStart.getTime(),serverTime=new Date(atob($("meta[name=server-utc-time]").attr("content")));serverTime.setTime(serverTime.getTime()+pageLoadOffset);let short_months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],long_months=["January","February","March","April","May","June","July","August","September","October","November","December"],short_days=["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],long_days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function getDateEnding(e){return 10<e&&e<14?"th":e%10==1?"st":e%10==2?"nd":e%10==3?"rd":"th"}let countdowns=setInterval(()=>{let e=(new Date).getTime()-pageLoadedTime.getTime(),t=new Date(serverTime.getTime()+e),a=document.getElementsByClassName("js-timer");for(let e=0;e<a.length;e++){let n=a[e];switch($(n).data("timer-type")){case"countdown":let e=atob($(n).data("count-down-date")),a=new Date(e).getTime()-t.getTime(),r="",o=Math.floor(a/864e5),s=Math.floor(a%864e5/36e5),d=Math.floor(a%36e5/6e4),i=Math.floor(a%6e4/1e3);r=o>0?o+"d ":r,r=(r=a>36e5?r+s+"h ":r)+d+"m ",r=a<864e5?r+i+"s":r,$(n).hasClass("js-timer__warning")&&a<parseInt($(n).data("count-down-warning"))&&!$(n).hasClass("red-txt")&&$(n).addClass("red-txt"),a<0&&(r="0s",$(n).removeClass("js-timer")),n.innerHTML=r;break;case"current":let l=$(n).data("time-format"),c={d:t.getDate().toString().padStart(2,"0"),D:short_days[t.getDay()],j:t.getDate(),l:long_days[t.getDay()],S:getDateEnding(t.getDate()),w:t.getDay()+1,F:long_months[t.getMonth()],m:(t.getMonth()+1).toString().padStart(2,"0"),M:short_months[t.getMonth()],n:t.getMonth()+1,Y:t.getFullYear(),y:t.getFullYear()%100,a:t.getHours()>=12?"pm":"am",h:(t.getHours()%12).toString().padStart(2,"0"),H:t.getHours().toString().padStart(2,"0"),i:t.getMinutes().toString().padStart(2,"0"),s:t.getSeconds().toString().padStart(2,"0")},g="",u=!1;for(let e=0;e<l.length;e++)u||"\\"!==l[e]?(g+=l[e]in c&&!u?c[l[e]]:l[e],u=!1):u=!0;$(n).html(g)}}},1e3);